{% extends 'admin/base.html' %}

{% load i18n admin_static admin_modify grp_tags xendor_tags %}
{% load firstof from future %}

{% block title %}Фотогалерея{% endblock %}

{% block extrastyle %}
{#    <link href="Path to your custom stylesheet" rel="stylesheet" type="text/css" />#}
{% endblock %}

{% block extrahead %}

{#    <script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/vendor/jquery.ui.widget.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.iframe-transport.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.fileupload.js"></script>#}

    <!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/vendor/jquery.ui.widget.js"></script>
<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Load-Image/js/load-image.js"></script>
<!-- The Canvas to Blob plugin is included for image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
<!-- Bootstrap JS is not required, but included for the responsive demo navigation -->
{#<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>#}
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.fileupload.js"></script>
<!-- The File Upload processing plugin -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.fileupload-process.js"></script>
<!-- The File Upload image preview & resize plugin -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.fileupload-image.js"></script>
<!-- The File Upload audio preview plugin -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.fileupload-audio.js"></script>
<!-- The File Upload video preview plugin -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.fileupload-video.js"></script>
<!-- The File Upload validation plugin -->
<script src="{{ STATIC_URL }}js/upload/jQuery-File-Upload-9.5.4/js/jquery.fileupload-validate.js"></script>
<script>
/*jslint unparam: true, regexp: true */
/*global window, $ */
(function($) {
    $(function () {
        'use strict';
        // Change this to the location of your server-side upload handler:
        var url = window.location.hostname === 'blueimp.github.io' ?
                    '//jquery-file-upload.appspot.com/' : 'server/php/',
            uploadButton = $('<button/>')
                .addClass('btn btn-primary')
                .prop('disabled', true)
                .text('Processing...')
                .on('click', function () {
                    var $this = $(this),
                        data = $this.data();
                    $this
                        .off('click')
                        .text('Abort')
                        .on('click', function () {
                            $this.remove();
                            data.abort();
                        });
                    data.submit().always(function () {
                        $this.remove();
                    });
                });
        $('#fileupload').fileupload({
            url: url,
            dataType: 'json',
            autoUpload: false,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 5000000, // 5 MB
            // Enable image resizing, except for Android and Opera,
            // which actually support image resizing, but fail to
            // send Blob objects via XHR requests:
            disableImageResize: /Android(?!.*Chrome)|Opera/
                .test(window.navigator.userAgent),
            previewMaxWidth: 100,
            previewMaxHeight: 100,
            previewCrop: true
        }).on('fileuploadadd', function (e, data) {
            data.context = $('<div/>').appendTo('#files');
            $.each(data.files, function (index, file) {
                var node = $('<p/>')
                        .append($('<span/>').text(file.name));
                if (!index) {
                    node
                        .append('<br>')
                        .append(uploadButton.clone(true).data(data));
                }
                node.appendTo(data.context);
            });
        }).on('fileuploadprocessalways', function (e, data) {
            var index = data.index,
                file = data.files[index],
                node = $(data.context.children()[index]);
            if (file.preview) {
                node
                    .prepend('<br>')
                    .prepend(file.preview);
            }
            if (file.error) {
                node
                    .append('<br>')
                    .append($('<span class="text-danger"/>').text(file.error));
            }
            if (index + 1 === data.files.length) {
                data.context.find('button')
                    .text('Upload')
                    .prop('disabled', !!data.files.error);
            }
        }).on('fileuploadprogressall', function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                'width',
                progress + '%'
            );
        }).on('fileuploaddone', function (e, data) {
            $.each(data.result.files, function (index, file) {
                if (file.url) {
                    var link = $('<a>')
                        .attr('target', '_blank')
                        .prop('href', file.url);
                    $(data.context.children()[index])
                        .wrap(link);
                } else if (file.error) {
                    var error = $('<span class="text-danger"/>').text(file.error);
                    $(data.context.children()[index])
                        .append('<br>')
                        .append(error);
                }
            });
        }).on('fileuploadfail', function (e, data) {
            $.each(data.files, function (index, file) {
                var error = $('<span class="text-danger"/>').text('File upload failed.');
                $(data.context.children()[index])
                    .append('<br>')
                    .append(error);
            });
        }).prop('disabled', !$.support.fileInput)
            .parent().addClass($.support.fileInput ? undefined : 'disabled');
    });
    })(grp.jQuery);
</script>

{#    <script type="text/javascript" charset="utf-8">#}
{#        (function($) {#}
{#            $(function () {#}
{#                'use strict';#}
{#                // Change this to the location of your server-side upload handler:#}
{#                var url = window.location.hostname === 'blueimp.github.io' ?#}
{#                            '//jquery-file-upload.appspot.com/' : 'server/php/';#}
{#                $('#fileupload').fileupload({#}
{#                    url: '.',#}
{#                    dataType: 'json',#}
{#                    done: function (e, data) {#}
{#                        $.each(data.result.files, function (index, file) {#}
{#                            $('<p/>').text(file.name).appendTo('#files');#}
{#                        });#}
{#                    },#}
{#                    progressall: function (e, data) {#}
{#                        var progress = parseInt(data.loaded / data.total * 100, 10);#}
{#                        $('#progress .progress-bar').css(#}
{#                            'width',#}
{#                            progress + '%'#}
{#                        );#}
{#                    }#}
{#                }).prop('disabled', !$.support.fileInput)#}
{#                    .parent().addClass($.support.fileInput ? undefined : 'disabled');#}
{#            });#}
{#        })(grp.jQuery);#}
{##}
{##}
{#    </script>#}

{#    <script src="{{ STATIC_URL }}js/upload/jquery.ui.widget.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/tmpl.min.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/load-image.min.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/canvas-to-blob.min.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/bootstrap.min.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/bootstrap-image-gallery.min.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/jquery.iframe-transport.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/jquery.fileupload.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/jquery.fileupload-fp.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/jquery.fileupload-ui.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/locale.js"></script>#}
{#    <script src="{{ STATIC_URL }}js/upload/upload.js"></script>#}
{% endblock %}

{% block breadcrumbs %}
    <ul>
        <li><a href="{% url 'admin:index' %}">{% trans 'Home' %}</a></li>
        <li><a href="{{ back_link }}">{{ material }}</a></li>
        <li>Фотогалерея</li>
    </ul>
{% endblock %}

{% block pretitle %}
    <ul class="grp-messagelist">
        <li class="grp-info">
            Для добавления фотографий в список загрузки, перетащите их на любую область страницы или нажмите кнопку "Загрузить файлы"
        </li>
    </ul>
{% endblock %}

{% block content_title %}<h1>Фотогалерея для &laquo;{{ material }}&raquo;</h1>{% endblock %}


{% block content %}

    <form id="fileupload" method="post" action="" enctype="multipart/form-data">
        {% csrf_token %}


        <!--прогрессбар-->
        <div class="span5 fileupload-progress fade">
            <div class="progress progress-success progres-striped active">
                <div class="bar" style="width:0%"></div>
            </div>
            <div class="progress-extended">&nbsp;</div>
        </div>

        <!--управляющие кнопки-->
        <footer class="grp-module grp-submit-row grp-fixed-footer">
            <header style="display:none"><h1>Submit Options</h1></header>
            <ul>
                <li class="grp-float-left"><input type="file" name="file" class="grp-button grp-default" multiple></li>
                <li class="grp-float-left">
                    <button type="submit" class="grp-button">
                        Начать загрузку
                    </button>
                </li>
                <li class="grp-float-left">
                    <button type="reset" class="grp-button grp-cancel-link">Отменить загрузку</button>
                </li>
                <li>
                    <input type="checkbox" id="select-all" class="toggle" />
                    <button type="button" class="grp-button grp-delete-link">
                        Удалить файлы
                    </button>
                </li>
            </ul>
        </footer>


        <div class="fileupload-loading"></div>

        <!--Фоттки в наличии-->
        {% if images %}
            <table class="table table-striped">
                <tbody class="files" data-toggle="modal-gallery" data-target="#modal-gallery">
                {% for image in images %}
                <tr class="template-download">
                    <td class="preview">
                        <a href="{{ MEDIA_URL }}{{ image.image }}" rel="gallery" download="{{ MEDIA_URL }}{{ image.image }}">
                            <img src="{{ image.image|xthumbnail:'200;200' }}" />
                        </a>
                    </td>
                    <td class="name"></td>
                    <td class="size"><span></span></td>
                    <td colspan="2"></td>

                    <td class="delete">
                        <button class="btn btn-danger" data-type="DELETE" data-url="delete/{{ image.pk }}/">
                            <i class="icon-trash icon-white"></i>
                            <span>Удалить</span>
                        </button>
                        <input type="checkbox" name="delete" value="1">
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </form>

{#    <div class="fileupload-content">#}
{#        <table class="files"></table>#}
{#        <div class="fileupload-progressbar"></div>#}
{#    </div>#}

    <!-- modal-gallery is the modal dialog used for the image gallery -->
{#    <div id="modal-gallery" class="modal modal-gallery hide fade" >#}
{#        <div class="modal-header">#}
{#            <a class="close" data-dismiss="modal">&times;</a>#}
{#            <h3 class="modal-title"></h3>#}
{#        </div>#}
{#        <div class="modal-body"><div class="modal-image"></div></div>#}
{#        <div class="modal-footer">#}
{#            <a class="btn modal-download" target="_blank">#}
{#                <i class="icon-download"></i>#}
{#                <span>Скачать</span>#}
{#            </a>#}
{#            <a class="btn btn-success modal-play modal-slideshow" data-slideshow="5000">#}
{#                <i class="icon-play icon-white"></i>#}
{#                <span>Слайдшоу</span>#}
{#            </a>#}
{#            <a class="btn btn-info modal-prev">#}
{#                <i class="icon-arrow-left icon-white"></i>#}
{#                <span>Назад</span>#}
{#            </a>#}
{#            <a class="btn btn-primary modal-next">#}
{#                <span>Вперед</span>#}
{#                <i class="icon-arrow-right icon-white"></i>#}
{#            </a>#}
{#        </div>#}
{#    </div>#}
{% endblock %}

